import{_ as m}from"./vendor-b1776dd9.js";m.Root;let x=0,l={};function v(s,e){const t=Date.now();return t-x>=6e4&&(x=t,l={}),l[s]?Promise.resolve(l[s]):e(s).then(r=>l[s]=r)}class ${constructor(e){this.headers=e}raw(e){return v(e,t=>fetch(b(t),{headers:this.headers}).then(r=>r.text()))}json(e){return this.raw(e).then(JSON.parse)}cheerio(e){return this.raw(e).then(m.load)}next(e){return this.cheerio(e).then(t=>JSON.parse(t("#__NEXT_DATA__").first().html()))}}const h=new $;function b(s){return`https://cors.bridged.cc/${s}`}var p;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.ONGOING=1]="ONGOING",s[s.COMPLETED=2]="COMPLETED",s[s.LICENSED=3]="LICENSED"})(p||(p={}));function c(s){return s}const U={mcg:/\/read\/manga(?<manga>\/.*?)(?<chapter>\/.*?)(?<group>\/.*?)(\/)?$/i,m:/\/read\/manga(?<manga>\/.*?)(\/)?$/i};class g{constructor(e){this.baseUrl=e}parseUrl(e){const t=e.pathname;console.log(t);const r=t.match(U.mcg);if(console.log(r),r)return Promise.resolve({sourceId:this.id,mangaId:r.groups.manga.substr(1),chapterId:`${r.groups.chapter.substr(1)}-${r.groups.group.substr(1)}`});const a=t.match(U.m);if(a)return Promise.resolve({sourceId:this.id,mangaId:a.groups.manga.substr(1)})}getManga(e){return h.json(`${this.baseUrl}/api/series/${e}`).then(t=>{const r=[...t.preferred_sort,...Object.keys(t.groups)];return c({id:t.slug,source:this.id,title:t.title,cover:`${this.baseUrl}${t.cover}`,authors:[t.author],artists:[t.artist],description:t.description,status:p.UNKNOWN,chapters:Object.entries(t.chapters).map(([a,n])=>{const i=Object.keys(n.groups).filter(o=>r.includes(o))[0];return c({id:`${a}-${i}`,number:+a,volume:+n.volume,title:n.title,uploadDate:n.release_date[i],scanlators:t.groups[i].split(" | ")})})})})}getPages(e,t){return h.json(`${this.baseUrl}/api/series/${e}`).then(r=>{const[a,n]=t.split("-"),i=r.chapters[a];return i.groups[n].map((o,u)=>c({index:u,url:`${this.baseUrl}/media/manga/${r.slug}/chapters/${i.folder}/${n}/${o}`}))})}}const j=/\/series\/(?<manga>.*?)(\/(?<chapter>.*?))?\/?$/i;class O{constructor(){this.baseUrl="https://catmanga.org",this.imageBaseUrl="https://images.catmanga.org"}parseUrl(e){const r=e.pathname.match(j);if(r)return Promise.resolve({sourceId:this.id,mangaId:r.groups.manga,chapterId:r.groups.chapter})}getManga(e){return h.json(`${this.baseUrl}/api/series/${e}`).then(t=>{const r=t.status;return c({id:t.series_id,source:this.id,title:t.title,cover:this.imageBaseUrl+t.cover_art.source,altTitles:t.alt_titles,authors:t.authors,description:t.description,tags:t.genres,status:r=="ongoing"?p.ONGOING:r=="completed"?p.COMPLETED:p.UNKNOWN,chapters:t.chapters.map(a=>c({id:a.number.toString(),volume:a.volume,number:a.number,title:a.title,scanlators:a.groups}))})})}getPages(e,t){return h.next(`${this.baseUrl}/series/${e}/${t}`).then(r=>r.props.pageProps.pages.map((a,n)=>c({url:a,index:n})))}}m.Cheerio;const N={mangaChapter:/manga\/(?<manga>.*?)(\/chapter-(?<chapter>.*?))?(\?.*)?\/?$/i};class P{constructor(e,t={}){var r;this.baseUrl=e,this.useNewAjax=(r=t.newAjax)!=null?r:!1}parseChapter(e,t){const r=t.children("a"),n=r.attr("href").match(N.mangaChapter).groups.chapter;return{id:n,number:+n.replace("-","."),title:r.text().trim()}}getChaptersAjax(e,t,r){return fetch(b(t),{method:"post",body:r}).then(a=>a.text()).then(a=>{const n=m.load(a);return n("li.wp-manga-chapter").map((i,o)=>this.parseChapter(e,n(o))).get()})}getImage(e){var t,r,a,n;return((n=(a=(t=e.attr("data-src"))!=null?t:e.attr("data-lazy-src"))!=null?a:(r=e.attr("srcset"))==null?void 0:r.split(" ")[0])!=null?n:e.attr("src")).trim()}parseUrl(e){const t=e.pathname.match(N.mangaChapter);if(t)return Promise.resolve({sourceId:this.id,mangaId:t.groups.manga,chapterId:t.groups.chapter})}getManga(e){return h.cheerio(`${this.baseUrl}/manga/${e}`).then(t=>{const r=t("div[id^=manga-chapters-holder]"),a=t("li.wp-manga-chapter");let n;if(a.length>0)n=Promise.resolve(a.map((i,o)=>this.parseChapter(e,t(o))).get());else if(this.useNewAjax)n=this.getChaptersAjax(e,`${this.baseUrl}/manga/${e}/ajax/chapters`);else{const i=new URLSearchParams;i.append("action","manga_get_chapters"),i.append("manga",r.attr("data-id")),n=this.getChaptersAjax(e,`${this.baseUrl}/wp-admin/admin-ajax.php`,i)}return n.then(i=>c({source:this.id,id:e,title:t("div.post-title h1").first().text().trim(),altTitles:t(".post-content_item:contains(Alt) .summary-content").text().trim().split(", "),cover:this.getImage(t("div.summary_image img").first()),authors:t("div.author-content > a").map((o,u)=>t(u).text()).get(),artists:t("div.artist-content > a").map((o,u)=>t(u).text()).get(),tags:t("div.genres-content a").map((o,u)=>t(u).text()).get(),description:t("div.description-summary div.summary__content").text().trim(),status:p.UNKNOWN,chapters:i}))})}getPages(e,t){return h.cheerio(`${this.baseUrl}/manga/${e}/chapter-${t}?style=list`).then(r=>r("div.page-break, li.blocks-gallery-item").map((a,n)=>c({index:a,url:this.getImage(r(n).children("img").first())})).get())}}class y{constructor(e,t={}){var r;this.baseUrl=e,this.mangaDir=(r=t.mangaDir)!=null?r:"manga",this.mangaRegex=new RegExp(`${this.mangaDir}/(?<manga>.*?)(/)?$`,"i"),this.chapterRegex=new RegExp(`${e}/(?<chapter>.*?)(/)?$`,"i")}parseUrl(e){const t=e.pathname.match(this.mangaRegex);if(t)return Promise.resolve({sourceId:this.id,mangaId:t.groups.manga})}getManga(e){return h.cheerio(`${this.baseUrl}/${this.mangaDir}/${e}`).then(t=>{const r=t("#chapterlist li .eph-num a");let a=r.length;return c({id:e,source:this.id,title:t("h1.entry-title").first().text(),cover:t(".thumb img").first().attr("src"),authors:[t(".tsinfo .imptdt:contains(Author) i").first().text()],artists:[t(".tsinfo .imptdt:contains(Artist) i").first().text()],status:p.UNKNOWN,description:t(".desc, .entry-content[itemprop=description]").map((n,i)=>t(i).text().trim()).get().join(`
`),chapters:r.map((n,i)=>{const o=t(i);return c({id:o.attr("href").match(this.chapterRegex).groups.chapter,number:a--,title:o.children(".chapternum").text()})}).get()})})}getPages(e,t){return h.cheerio(`${this.baseUrl}/${t}`).then(r=>r("div#readerarea img[loading=lazy]").map((a,n)=>c({index:a,url:r(n).attr("src")})).get())}}const d={catmanga:new O,coloredcouncil:new g("https://coloredcouncil.moe"),danke:new g("https://danke.moe"),guya:new g("https://guya.moe"),hachirumi:new g("https://hachirumi.com"),magicaltrans:new g("https://mahoushoujobu.com"),xun:new P("https://xunscans.xyz"),anitationarts:new y("https://anitationarts.org")},w={};for(const s in d){const e=d[s];e.id=s,w[new URL(e.baseUrl).host]=e}const f={unknownSource(s){return`Unknown source: ${s}`}};async function _(s){const e=new URL(s),t=w[e.host];return t?t.parseUrl(e):Promise.reject(f.unknownSource(e.host))}async function I(s,e){const t=d[s];return t?t.getManga(e):Promise.reject(f.unknownSource(s))}async function E(s,e,t){const r=d[s];return r?r.getPages(e,t):Promise.reject(f.unknownSource(s))}export{E as a,I as g,_ as p};
