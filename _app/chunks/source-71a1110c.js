import{_ as $}from"./vendor-7ce006f1.js";import{c as g}from"./database-62637bf5.js";const f=6e4,U=864e5;$.Root;async function B(i,e,t){if(e<=0)return t(i);const r=Date.now();return g.fetcher.get(i,a=>r-a.time>=e?t(i).then(s=>(g.fetcher.update(i,{time:r,body:s}),s)):a.body).catch(()=>t(i).then(a=>(g.fetcher.put({url:i,time:r,body:a}),a)))}class k{constructor(e){this.headers=e}raw(e,t=10*f){return console.log(e),B(e,t,r=>fetch(O(r),{headers:this.headers}).then(a=>a.text()))}json(e,t=10*f){return this.raw(e,t).then(JSON.parse)}cheerio(e,t=10*f){return this.raw(e,t).then($.load)}next(e,t=10*f){return this.cheerio(e,t).then(r=>JSON.parse(r("#__NEXT_DATA__").first().html()))}}const c=new k;function O(i){return`https://cors.bridged.cc/${i}`}var l;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.ONGOING=1]="ONGOING",i[i.COMPLETED=2]="COMPLETED",i[i.LICENSED=3]="LICENSED"})(l||(l={}));function p(i){return i}const C={mcg:/\/read\/manga(?<manga>\/.*?)(?<chapter>\/.*?)(?<group>\/.*?)(\/)?$/i,m:/\/read\/manga(?<manga>\/.*?)(\/)?$/i};class d{constructor(e){this.baseUrl=e}parseUrl(e){const t=e.pathname,r=t.match(C.mcg);if(r)return Promise.resolve({sourceId:this.id,mangaId:r.groups.manga.substr(1),chapterId:`${r.groups.chapter.substr(1)}-${r.groups.group.substr(1)}`});const a=t.match(C.m);if(a)return Promise.resolve({sourceId:this.id,mangaId:a.groups.manga.substr(1)})}getManga(e){return c.json(`${this.baseUrl}/api/series/${e}`).then(t=>{const r=[...t.preferred_sort,...Object.keys(t.groups)];return p({id:t.slug,source:this.id,url:`${this.baseUrl}/read/manga/${e}`,title:t.title,cover:`${this.baseUrl}${t.cover}`,authors:[t.author],artists:[t.artist],description:t.description,status:l.UNKNOWN,chapters:Object.entries(t.chapters).map(([a,s])=>{const n=Object.keys(s.groups).filter(h=>r.includes(h))[0];return p({id:`${a}-${n}`,number:+a,volume:+s.volume,title:s.title,uploadDate:s.release_date[n],scanlators:t.groups[n].split(" | ")})})})})}getPages(e,t){return c.json(`${this.baseUrl}/api/series/${e}`).then(r=>{const[a,s]=t.split("-"),n=r.chapters[a];return n.groups[s].map((h,u)=>p({index:u,url:`${this.baseUrl}/media/manga/${r.slug}/chapters/${n.folder}/${s}/${h}`}))})}}const I=/\/series\/(?<manga>.*?)(\/(?<chapter>.*?))?\/?$/i;class R{constructor(){this.baseUrl="https://catmanga.org",this.imageBaseUrl="https://images.catmanga.org"}parseUrl(e){const r=e.pathname.match(I);if(r)return Promise.resolve({sourceId:this.id,mangaId:r.groups.manga,chapterId:r.groups.chapter})}getManga(e){return c.json(`${this.baseUrl}/api/series/${e}`).then(t=>{const r=t.status;return p({id:t.series_id,source:this.id,url:`${this.baseUrl}/series/${e}`,title:t.title,cover:this.imageBaseUrl+t.cover_art.source,altTitles:t.alt_titles,authors:t.authors,description:t.description,tags:t.genres,status:r=="ongoing"?l.ONGOING:r=="completed"?l.COMPLETED:l.UNKNOWN,chapters:t.chapters.map(a=>p({id:a.number.toString(),volume:a.volume,number:a.number,title:a.title,scanlators:a.groups}))})})}getPages(e,t){return c.next(`${this.baseUrl}/series/${e}/${t}`).then(r=>r.props.pageProps.pages.map((a,s)=>p({url:a,index:s})))}}$.Cheerio;const D={mangaChapter:/manga\/(?<manga>.*?)(\/chapter-(?<chapter>.*?))?(\?.*)?\/?$/i};class T{constructor(e,t={}){var r;this.baseUrl=e,this.useNewAjax=(r=t.newAjax)!=null?r:!1}parseChapter(e,t){const r=t.children("a"),s=r.attr("href").match(D.mangaChapter).groups.chapter;return{id:s,number:+s.replace("-","."),title:r.text().trim()}}getChaptersAjax(e,t,r){return fetch(O(t),{method:"post",body:r}).then(a=>a.text()).then(a=>{const s=$.load(a);return s("li.wp-manga-chapter").map((n,h)=>this.parseChapter(e,s(h))).get()})}getImage(e){var t,r,a,s;return((s=(a=(t=e.attr("data-src"))!=null?t:e.attr("data-lazy-src"))!=null?a:(r=e.attr("srcset"))==null?void 0:r.split(" ")[0])!=null?s:e.attr("src")).trim()}parseUrl(e){const t=e.pathname.match(D.mangaChapter);if(t)return Promise.resolve({sourceId:this.id,mangaId:t.groups.manga,chapterId:t.groups.chapter})}getManga(e){return c.cheerio(`${this.baseUrl}/manga/${e}`).then(t=>{const r=t("div[id^=manga-chapters-holder]"),a=t("li.wp-manga-chapter");let s;if(a.length>0)s=Promise.resolve(a.map((n,h)=>this.parseChapter(e,t(h))).get());else if(this.useNewAjax)s=this.getChaptersAjax(e,`${this.baseUrl}/manga/${e}/ajax/chapters`);else{const n=new URLSearchParams;n.append("action","manga_get_chapters"),n.append("manga",r.attr("data-id")),s=this.getChaptersAjax(e,`${this.baseUrl}/wp-admin/admin-ajax.php`,n)}return s.then(n=>p({source:this.id,id:e,url:`${this.baseUrl}/manga/${e}`,title:t("div.post-title h1").first().text().trim(),altTitles:t(".post-content_item:contains(Alt) .summary-content").text().trim().split(", "),cover:this.getImage(t("div.summary_image img").first()),authors:t("div.author-content > a").map((h,u)=>t(u).text()).get(),artists:t("div.artist-content > a").map((h,u)=>t(u).text()).get(),tags:t("div.genres-content a").map((h,u)=>t(u).text()).get(),description:t("div.description-summary div.summary__content").text().trim(),status:l.UNKNOWN,chapters:n}))})}getPages(e,t){return c.cheerio(`${this.baseUrl}/manga/${e}/chapter-${t}?style=list`).then(r=>r("div.page-break, li.blocks-gallery-item").map((a,s)=>p({index:a,url:this.getImage(r(s).children("img").first())})).get())}}class G{constructor(e,t={}){var r;this.baseUrl=e,this.mangaDir=(r=t.mangaDir)!=null?r:"manga",this.mangaRegex=new RegExp(`${this.mangaDir}/(?<manga>.*?)(/)?$`,"i"),this.chapterRegex=new RegExp(`${e}/(?<chapter>.*?)(/)?$`,"i")}parseUrl(e){const t=e.pathname.match(this.mangaRegex);if(t)return Promise.resolve({sourceId:this.id,mangaId:t.groups.manga})}getManga(e){return c.cheerio(`${this.baseUrl}/${this.mangaDir}/${e}`).then(t=>{const r=t("#chapterlist li .eph-num a");let a=r.length;return p({id:e,source:this.id,url:`${this.baseUrl}/${this.mangaDir}/${e}`,title:t("h1.entry-title").first().text(),cover:t(".thumb img").first().attr("src"),authors:[t(".tsinfo .imptdt:contains(Author) i").first().text()],artists:[t(".tsinfo .imptdt:contains(Artist) i").first().text()],status:l.UNKNOWN,description:t(".desc, .entry-content[itemprop=description]").map((s,n)=>t(n).text().trim()).get().join(`
`),chapters:r.map((s,n)=>{const h=t(n);return p({id:h.attr("href").match(this.chapterRegex).groups.chapter,number:a--,title:h.children(".chapternum").text()})}).get()})})}getPages(e,t){return c.cheerio(`${this.baseUrl}/${t}`).then(r=>r("div#readerarea img[loading=lazy]").map((a,s)=>p({index:a,url:r(s).attr("src")})).get())}}const L=/\/title\/(?<manga>.*?)(\/.*)?$/i;class M{constructor(){this.baseUrl="https://mangadex.org",this.apiBaseUrl="https://api.mangadex.org",this.uploadsBaseUrl="https://uploads.mangadex.org"}parseUrl(e){const r=e.pathname.match(L);if(r)return Promise.resolve({sourceId:this.id,mangaId:r.groups.manga})}getManga(e){return c.json(`${this.apiBaseUrl}/manga/${e}`).then(t=>c.json(`${this.apiBaseUrl}/manga/${e}/aggregate?translatedLanguage[]=en`).then(async r=>{const a=t.data.relationships.find(o=>o.type==="cover_art"),s=a?await c.json(`${this.apiBaseUrl}/cover/${a.id}`,U):void 0,n=await Promise.all(t.data.relationships.filter(o=>o.type==="author").map(o=>c.json(`${this.apiBaseUrl}/author/${o.id}`,U))),h=await Promise.all(t.data.relationships.filter(o=>o.type==="artist").map(o=>c.json(`${this.apiBaseUrl}/author/${o.id}`,U))),u=[],N=[];for(const o in r.volumes){const w=r.volumes[o].chapters,j=+o;for(const E in w){const y=w[E];N.push(c.json(`${this.apiBaseUrl}/chapter/${y.id}`).then(b=>Promise.all(b.data.relationships.filter(m=>m.type==="scanlation_group").map(m=>c.json(`${this.apiBaseUrl}/group/${m.id}`,U))).then(m=>{var P;return u.push({id:y.id,volume:Number.isNaN(j)?void 0:j,number:(P=b.data.attributes.chapter)!=null?P:0,title:b.data.attributes.title,scanlators:m.map(A=>A.data.attributes.name),uploadDate:new Date(b.data.attributes.publishAt).getTime()/1e3})})))}}return await Promise.all(N),p({id:e,source:this.id,url:`${this.baseUrl}/title/${e}`,title:t.data.attributes.title.en,cover:s?`${this.uploadsBaseUrl}/covers/${e}/${s.data.attributes.fileName}`:"",altTitles:t.data.attributes.altTitles.map(o=>Object.values(o)).flat(),authors:n.map(o=>o.data.attributes.name),artists:h.map(o=>o.data.attributes.name),status:l.ONGOING,description:t.data.attributes.description.en,chapters:u})}))}getPages(e,t){return c.json(`${this.apiBaseUrl}/at-home/server/${t}`).then(r=>c.json(`${this.apiBaseUrl}/chapter/${t}`).then(a=>a.data.attributes.data.map((s,n)=>p({index:n,url:`${r.baseUrl}/data/${a.data.attributes.hash}/${s}`}))))}}const x={catmanga:new R,mangadex:new M,coloredcouncil:new d("https://coloredcouncil.moe"),danke:new d("https://danke.moe"),guya:new d("https://guya.moe"),hachirumi:new d("https://hachirumi.com"),magicaltrans:new d("https://mahoushoujobu.com"),xun:new T("https://xunscans.xyz"),anitationarts:new G("https://anitationarts.org")},_={};for(const i in x){const e=x[i];e.id=i,_[new URL(e.baseUrl).host]=e}const v={unknownSource(i){return`Unknown source: ${i}`}};async function z(i){const e=new URL(i),t=_[e.host];return t?t.parseUrl(e):Promise.reject(v.unknownSource(e.host))}async function J(i,e,t=!1){const r=x[i];return r?(t?await void 0:g.manga.get({source:i,id:e})).then(s=>s!=null?s:r.getManga(e).then(n=>(g.manga.put(n),n))):Promise.reject(v.unknownSource(i))}async function F(i,e,t){const r=x[i];return r?r.getPages(e,t):Promise.reject(v.unknownSource(i))}export{F as a,J as g,z as p};
