import{_ as b,Z as A}from"./vendor-b1776dd9.js";const x=6e4,$=864e5;b.Root;class B extends A{constructor(){super("CacheDatabase");this.version(1).stores({caches:"url"})}}const f=new B;async function k(s,e,t){if(e<=0)return t(s);const a=Date.now();return f.caches.get(s,r=>a-r.time>=e?t(s).then(i=>(f.caches.update(s,{time:a,body:i}),i)):r.body).catch(()=>t(s).then(r=>(f.caches.put({url:s,time:a,body:r}),r)))}class R{constructor(e){this.headers=e}raw(e,t=10*x){return k(e,t,a=>fetch(O(a),{headers:this.headers}).then(r=>r.text()))}json(e,t=10*x){return this.raw(e,t).then(JSON.parse)}cheerio(e,t=10*x){return this.raw(e,t).then(b.load)}next(e,t=10*x){return this.cheerio(e,t).then(a=>JSON.parse(a("#__NEXT_DATA__").first().html()))}}const c=new R;function O(s){return`https://cors.bridged.cc/${s}`}var l;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.ONGOING=1]="ONGOING",s[s.COMPLETED=2]="COMPLETED",s[s.LICENSED=3]="LICENSED"})(l||(l={}));function p(s){return s}const C={mcg:/\/read\/manga(?<manga>\/.*?)(?<chapter>\/.*?)(?<group>\/.*?)(\/)?$/i,m:/\/read\/manga(?<manga>\/.*?)(\/)?$/i};class g{constructor(e){this.baseUrl=e}parseUrl(e){const t=e.pathname,a=t.match(C.mcg);if(a)return Promise.resolve({sourceId:this.id,mangaId:a.groups.manga.substr(1),chapterId:`${a.groups.chapter.substr(1)}-${a.groups.group.substr(1)}`});const r=t.match(C.m);if(r)return Promise.resolve({sourceId:this.id,mangaId:r.groups.manga.substr(1)})}getManga(e){return c.json(`${this.baseUrl}/api/series/${e}`).then(t=>{const a=[...t.preferred_sort,...Object.keys(t.groups)];return p({id:t.slug,source:this.id,title:t.title,cover:`${this.baseUrl}${t.cover}`,authors:[t.author],artists:[t.artist],description:t.description,status:l.UNKNOWN,chapters:Object.entries(t.chapters).map(([r,i])=>{const n=Object.keys(i.groups).filter(h=>a.includes(h))[0];return p({id:`${r}-${n}`,number:+r,volume:+i.volume,title:i.title,uploadDate:i.release_date[n],scanlators:t.groups[n].split(" | ")})})})})}getPages(e,t){return c.json(`${this.baseUrl}/api/series/${e}`).then(a=>{const[r,i]=t.split("-"),n=a.chapters[r];return n.groups[i].map((h,u)=>p({index:u,url:`${this.baseUrl}/media/manga/${a.slug}/chapters/${n.folder}/${i}/${h}`}))})}}const T=/\/series\/(?<manga>.*?)(\/(?<chapter>.*?))?\/?$/i;class G{constructor(){this.baseUrl="https://catmanga.org",this.imageBaseUrl="https://images.catmanga.org"}parseUrl(e){const a=e.pathname.match(T);if(a)return Promise.resolve({sourceId:this.id,mangaId:a.groups.manga,chapterId:a.groups.chapter})}getManga(e){return c.json(`${this.baseUrl}/api/series/${e}`).then(t=>{const a=t.status;return p({id:t.series_id,source:this.id,title:t.title,cover:this.imageBaseUrl+t.cover_art.source,altTitles:t.alt_titles,authors:t.authors,description:t.description,tags:t.genres,status:a=="ongoing"?l.ONGOING:a=="completed"?l.COMPLETED:l.UNKNOWN,chapters:t.chapters.map(r=>p({id:r.number.toString(),volume:r.volume,number:r.number,title:r.title,scanlators:r.groups}))})})}getPages(e,t){return c.next(`${this.baseUrl}/series/${e}/${t}`).then(a=>a.props.pageProps.pages.map((r,i)=>p({url:r,index:i})))}}b.Cheerio;const D={mangaChapter:/manga\/(?<manga>.*?)(\/chapter-(?<chapter>.*?))?(\?.*)?\/?$/i};class L{constructor(e,t={}){var a;this.baseUrl=e,this.useNewAjax=(a=t.newAjax)!=null?a:!1}parseChapter(e,t){const a=t.children("a"),i=a.attr("href").match(D.mangaChapter).groups.chapter;return{id:i,number:+i.replace("-","."),title:a.text().trim()}}getChaptersAjax(e,t,a){return fetch(O(t),{method:"post",body:a}).then(r=>r.text()).then(r=>{const i=b.load(r);return i("li.wp-manga-chapter").map((n,h)=>this.parseChapter(e,i(h))).get()})}getImage(e){var t,a,r,i;return((i=(r=(t=e.attr("data-src"))!=null?t:e.attr("data-lazy-src"))!=null?r:(a=e.attr("srcset"))==null?void 0:a.split(" ")[0])!=null?i:e.attr("src")).trim()}parseUrl(e){const t=e.pathname.match(D.mangaChapter);if(t)return Promise.resolve({sourceId:this.id,mangaId:t.groups.manga,chapterId:t.groups.chapter})}getManga(e){return c.cheerio(`${this.baseUrl}/manga/${e}`).then(t=>{const a=t("div[id^=manga-chapters-holder]"),r=t("li.wp-manga-chapter");let i;if(r.length>0)i=Promise.resolve(r.map((n,h)=>this.parseChapter(e,t(h))).get());else if(this.useNewAjax)i=this.getChaptersAjax(e,`${this.baseUrl}/manga/${e}/ajax/chapters`);else{const n=new URLSearchParams;n.append("action","manga_get_chapters"),n.append("manga",a.attr("data-id")),i=this.getChaptersAjax(e,`${this.baseUrl}/wp-admin/admin-ajax.php`,n)}return i.then(n=>p({source:this.id,id:e,title:t("div.post-title h1").first().text().trim(),altTitles:t(".post-content_item:contains(Alt) .summary-content").text().trim().split(", "),cover:this.getImage(t("div.summary_image img").first()),authors:t("div.author-content > a").map((h,u)=>t(u).text()).get(),artists:t("div.artist-content > a").map((h,u)=>t(u).text()).get(),tags:t("div.genres-content a").map((h,u)=>t(u).text()).get(),description:t("div.description-summary div.summary__content").text().trim(),status:l.UNKNOWN,chapters:n}))})}getPages(e,t){return c.cheerio(`${this.baseUrl}/manga/${e}/chapter-${t}?style=list`).then(a=>a("div.page-break, li.blocks-gallery-item").map((r,i)=>p({index:r,url:this.getImage(a(i).children("img").first())})).get())}}class M{constructor(e,t={}){var a;this.baseUrl=e,this.mangaDir=(a=t.mangaDir)!=null?a:"manga",this.mangaRegex=new RegExp(`${this.mangaDir}/(?<manga>.*?)(/)?$`,"i"),this.chapterRegex=new RegExp(`${e}/(?<chapter>.*?)(/)?$`,"i")}parseUrl(e){const t=e.pathname.match(this.mangaRegex);if(t)return Promise.resolve({sourceId:this.id,mangaId:t.groups.manga})}getManga(e){return c.cheerio(`${this.baseUrl}/${this.mangaDir}/${e}`).then(t=>{const a=t("#chapterlist li .eph-num a");let r=a.length;return p({id:e,source:this.id,title:t("h1.entry-title").first().text(),cover:t(".thumb img").first().attr("src"),authors:[t(".tsinfo .imptdt:contains(Author) i").first().text()],artists:[t(".tsinfo .imptdt:contains(Artist) i").first().text()],status:l.UNKNOWN,description:t(".desc, .entry-content[itemprop=description]").map((i,n)=>t(n).text().trim()).get().join(`
`),chapters:a.map((i,n)=>{const h=t(n);return p({id:h.attr("href").match(this.chapterRegex).groups.chapter,number:r--,title:h.children(".chapternum").text()})}).get()})})}getPages(e,t){return c.cheerio(`${this.baseUrl}/${t}`).then(a=>a("div#readerarea img[loading=lazy]").map((r,i)=>p({index:r,url:a(i).attr("src")})).get())}}const W=/\/title\/(?<manga>.*?)(\/.*)?$/i;class K{constructor(){this.baseUrl="https://mangadex.org",this.apiBaseUrl="https://api.mangadex.org",this.uploadsBaseUrl="https://uploads.mangadex.org"}parseUrl(e){const a=e.pathname.match(W);if(a)return Promise.resolve({sourceId:this.id,mangaId:a.groups.manga})}getManga(e){return c.json(`${this.apiBaseUrl}/manga/${e}`).then(t=>c.json(`${this.apiBaseUrl}/manga/${e}/aggregate?translatedLanguage[]=en`).then(async a=>{const r=t.data.relationships.find(o=>o.type==="cover_art"),i=r?await c.json(`${this.apiBaseUrl}/cover/${r.id}`,$):void 0,n=await Promise.all(t.data.relationships.filter(o=>o.type==="author").map(o=>c.json(`${this.apiBaseUrl}/author/${o.id}`,$))),h=await Promise.all(t.data.relationships.filter(o=>o.type==="artist").map(o=>c.json(`${this.apiBaseUrl}/author/${o.id}`,$))),u=[],N=[];for(const o in a.volumes){const w=a.volumes[o].chapters,j=+o;for(const I in w){const y=w[I];N.push(c.json(`${this.apiBaseUrl}/chapter/${y.id}`).then(d=>Promise.all(d.data.relationships.filter(m=>m.type==="scanlation_group").map(m=>c.json(`${this.apiBaseUrl}/group/${m.id}`,$))).then(m=>{var P;return u.push({id:y.id,volume:Number.isNaN(j)?void 0:j,number:(P=d.data.attributes.chapter)!=null?P:0,title:d.data.attributes.title,scanlators:m.map(E=>E.data.attributes.name),uploadDate:new Date(d.data.attributes.publishAt).getTime()/1e3})})))}}return await Promise.all(N),p({id:e,source:this.id,title:t.data.attributes.title.en,cover:i?`${this.uploadsBaseUrl}/covers/${e}/${i.data.attributes.fileName}`:"",altTitles:t.data.attributes.altTitles.map(o=>Object.values(o)).flat(),authors:n.map(o=>o.data.attributes.name),artists:h.map(o=>o.data.attributes.name),status:l.ONGOING,description:t.data.attributes.description.en,chapters:u})}))}getPages(e,t){return c.json(`${this.apiBaseUrl}/at-home/server/${t}`).then(a=>c.json(`${this.apiBaseUrl}/chapter/${t}`).then(r=>r.data.attributes.data.map((i,n)=>p({index:n,url:`${a.baseUrl}/data/${r.data.attributes.hash}/${i}`}))))}}const U={catmanga:new G,mangadex:new K,coloredcouncil:new g("https://coloredcouncil.moe"),danke:new g("https://danke.moe"),guya:new g("https://guya.moe"),hachirumi:new g("https://hachirumi.com"),magicaltrans:new g("https://mahoushoujobu.com"),xun:new L("https://xunscans.xyz"),anitationarts:new M("https://anitationarts.org")},_={};for(const s in U){const e=U[s];e.id=s,_[new URL(e.baseUrl).host]=e}const v={unknownSource(s){return`Unknown source: ${s}`}};async function J(s){const e=new URL(s),t=_[e.host];return t?t.parseUrl(e):Promise.reject(v.unknownSource(e.host))}async function F(s,e){const t=U[s];return t?t.getManga(e):Promise.reject(v.unknownSource(s))}async function H(s,e,t){const a=U[s];return a?a.getPages(e,t):Promise.reject(v.unknownSource(s))}export{H as a,F as g,J as p};
